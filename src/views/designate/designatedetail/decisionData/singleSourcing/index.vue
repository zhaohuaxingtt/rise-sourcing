<!--
 * @Author: wentliao
 * @Date: 2021-05-24 10:16:04
 * @Description: 决策资料-SingleSourcing
-->
<template>
    <iCard title="⽣产采购单⼀供应商说明 Single Sourcing for Production Purchasing">
        <div class="decision-data-singleSourcing-content">
            <div class="margin-top30 margin-bottom30">
                <iFormGroup inline>
                    <iFormItem label-width="130px"  label="项⽬名称 Project:">
                        <iText tooltip style="width:250px">{{projectName}}</iText>
                    </iFormItem>
                        <iFormItem label-width="180px"  label="定点申请单号 Project No.:">
                        <iText style="width:250px">{{nominateId}}</iText>
                    </iFormItem>
                </iFormGroup>
            </div>
            <!-- 表单部分 -->
            <div class="singleSourcing-table">
                <tableList
                    :selection="false"
                    class="table"
                    index
                    :tableData="tableListData"
                    :tableTitle="tableTitle"
                    :tableLoading="loading"
                >
                </tableList>
                <iPagination
                    class="margin-bottom20"
                    @size-change="handleSizeChange($event, getDetail)"
                    @current-change="handleCurrentChange($event, getDetail)"
                    background
                    :page-sizes="page.pageSizes"
                    :page-size="page.pageSize"
                    :layout="page.layout"
                    :current-page="page.currPage"
                    :total="page.totalCount" v-update
                />
            </div>
        </div>
    </iCard>
</template>

<script>
import {
  iCard,
  iPagination,
  iFormGroup,
  iFormItem,
  iText,
  iMessage,
} from "rise";
import {pageMixins} from '@/utils/pageMixins'
import tableList from "@/views/partsign/editordetail/components/tableList"
import {
    getSingleSourcing,
} from '@/api/designate/decisiondata/singleSourcing'
export default {
    mixins:[pageMixins],
     components:{
        iCard,
        iPagination,
        iFormGroup,
        iFormItem,
        iText,
        tableList,
    },
    name:'SingleSourcing',
    data(){
        return{
            loading: false,
            tableListData:[],
            tableTitle:[
                {name:'FS号\nFS No',key:'FSNo',props:'fsnrGsnrNum'},
                {name:'零件号\nPart No.',key:'PARTNO',props:'partNum'},
                {name:'零件名称\nPart Name',key:'PartName',props:'partNameCh'},
                {name:'供应商名称\nSupplier Name',key:'SupplierName',props:'suppliersName'},
                {name:'供应商编码\nSupplier No.',key:'SupplierNo.',props:'supplierId'},
                {name:'原因\nReason',key:'Reason',props:'singleReason'},
                {name:'原因部⻔\nCaused by',key:'Causedby',props:'department'},
            ],
            projectName:'',
            nominateId:'',
        }
    },
    created(){
        this.getDetail();
    },
    computed:{
        isPreview(){
            return this.$store.getters.isPreview;
        }
    },
    methods:{
        // 获取详情
        async getDetail(){
            this.loading =  true;
            const { query } = this.$route;
            const {desinateId="" } = query;
            const { page } = this;
            const params = {
                nominateId:desinateId,
                current:page.currPage,
                size:page.pageSize,
            };
            await getSingleSourcing(params).then((res)=>{
                const {code,data} =res;
                if(code == '200' && data){
                    const {resultPage={},nominateId='',cartypeProjectZhList=[]} = data;
                    const {total} = resultPage;
                    this.tableListData = resultPage.data || [];
                    this.page.totalCount = total;
                    this.nominateId = nominateId;
                    this.projectName = cartypeProjectZhList.join();
                }else{
                    iMessage.error(this.$i18n.locale === "zh" ? res.desZh : res.desEn)
                }
                this.loading =  false;

            }).catch((e)=>{
                    iMessage.error(this.$i18n.locale === "zh" ? e.desZh : e.desEn) 
                    this.loading =  false; 
                });
        },
    }

}
</script>

<style lang="scss" scoped>
.decision-data-singleSourcing-content{
    .singleSourcing-table{
        ::v-deep .el-table .cell{
            white-space:pre-line;
        }
    }
}

</style>